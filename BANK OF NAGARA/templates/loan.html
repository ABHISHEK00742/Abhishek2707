{% extends 'base.html' %}
{% block content %}
<h2 style="text-align:center">Loans</h2>
<p style="text-align:center">Home Loans at <strong>8% per year</strong>. Car/Bike Loans at <strong>5% per year</strong>.</p>

<h3 style="text-align:center">Simple Interest Calculator</h3>
<div class="centered">
    <form method="post" class="form-inline" id="calc-form">
        <input type="hidden" name="action" value="calc">
        <div style="width:100%;display:flex;justify-content:center">
            <label><strong>Loan Type</strong>
                <select name="loan_type" id="loan_type" style="font-weight:700">
                    <option value="home">Home Loan (8%)</option>
                    <option value="vehicle">Car/Bike Loan (5%)</option>
                </select>
            </label>
        </div>
        <input type="number" name="principal" id="principal" min="0" step="0.01" placeholder="Principal amount ($)" required>
        <input type="number" name="duration_years" id="duration_years" min="0" step="0.1" placeholder="Duration in years" required>
        <button class="btn" type="submit">Calculate</button>
    </form>
</div>

<div class="card center-card" id="calc-live" style="display:none">
    <p>Principal: $ <span id="live_p">0.00</span></p>
    <p>Rate: <span id="live_r">8</span>% per year</p>
    <p>Time: <span id="live_t">0</span> years</p>
    <p><strong>Simple Interest: $ <span id="live_si">0.00</span></strong></p>
</div>

{% if calculation %}
<div class="card center-card">
    <p>Principal: $ {{ '%.2f'|format(calculation.principal) }}</p>
    <p>Rate: {{ calculation.interest_rate }}% per year</p>
    <p>Time: {{ calculation.duration_years }} years</p>
    <p><strong>Simple Interest: $ {{ '%.2f'|format(calculation.interest) }}</strong></p>
</div>
{% endif %}

<h3 style="text-align:center">Apply for Loan</h3>
<div class="centered">
    <form method="post" class="form grid" id="applyForm">
        <input type="hidden" name="action" value="apply">
        <label>Loan Type
            <select name="loan_type">
                <option value="home">Home Loan (8%)</option>
                <option value="vehicle">Car/Bike Loan (5%)</option>
            </select>
        </label>
        <label>Principal Amount ($)
            <input type="number" name="principal" min="0" step="0.01" required>
        </label>
        <label>Duration (years)
            <input type="number" name="duration_years" min="0" step="0.1" required>
        </label>
        <label>Name of Person
            <input type="text" name="name" required>
        </label>
        <label>Father Name
            <input type="text" name="father_name" required>
        </label>
        <label>Aadhaar No.
            <input type="text" name="aadhaar" required>
        </label>
    </form>
</div>
<div class="centered">
    <button class="btn mt-05cm" type="submit" form="applyForm">Submit Application</button>
</div>

{% if applied %}
<p class="success" style="text-align:center">Application submitted successfully.</p>
{% endif %}

<script>
(function(){
    const principal = document.getElementById('principal');
    const duration = document.getElementById('duration_years');
    const typeSel = document.getElementById('loan_type');
    const box = document.getElementById('calc-live');
    const pOut = document.getElementById('live_p');
    const rOut = document.getElementById('live_r');
    const tOut = document.getElementById('live_t');
    const siOut = document.getElementById('live_si');
    if(!principal || !duration || !typeSel) return;
    function rate(){ return typeSel.value === 'home' ? 8.0 : 5.0; }
    function fmt(x){ return (isNaN(x)?0:x).toFixed(2); }
    function recalc(){
        const p = parseFloat(principal.value||'0');
        const t = parseFloat(duration.value||'0');
        const r = rate();
        const si = (p*r*t)/100.0;
        pOut.textContent = fmt(p);
        rOut.textContent = r;
        tOut.textContent = isNaN(t)?0:t;
        siOut.textContent = fmt(si);
        box.style.display = (p>0 && t>0) ? 'block' : 'none';
    }
    ['input','change'].forEach(ev=>{
        principal.addEventListener(ev,recalc);
        duration.addEventListener(ev,recalc);
        typeSel.addEventListener(ev,recalc);
    });
    recalc();
})();
</script>
{% endblock %}